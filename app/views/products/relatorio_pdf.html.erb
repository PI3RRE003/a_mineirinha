<div class="w-full font-sans">
  
  <%# --- Cabeçalho --- %>
  <div class="text-center mb-8 border-b-2 border-stone-800 pb-4">
    <div class="mb-4">
      <% if Rails.env.production? %>
        <%# No Render (Produção), transformamos a imagem em dados para o PDF não se perder %>
        <img src="<%= wicked_pdf_asset_base64('Mineirinha.png') %>" style="width: 100px;">
      <% else %>
        <%# No seu Windows (Desenvolvimento), usamos o caminho normal %>
        <%= image_tag "Mineirinha.png", style: "width: 100px;" %>
      <% end %>
    </div>
    <h1 class="text-4xl font-bold text-stone-800 uppercase tracking-widest mb-1">A Mineirinha</h1>
    <h2 class="text-xl text-stone-600">Relatório de Vendas</h2>
    <p class="text-xs text-stone-400 mt-2">Gerado em: <%= Time.now.strftime("%d/%m/%Y às %H:%M") %></p>
    
    <% if params[:data_inicio].present? || params[:data_final].present? %>
      <div class="mt-4 inline-block bg-stone-100 px-4 py-1 rounded text-sm font-bold border border-stone-300">
        Período: 
        <%= params[:data_inicio].present? ? Date.parse(params[:data_inicio]).strftime("%d/%m/%Y") : "Início" %> 
        até 
        <%= params[:data_final].present? ? Date.parse(params[:data_final]).strftime("%d/%m/%Y") : "Hoje" %>
      </div>
    <% end %>
  </div>

  <%# --- Resumo Financeiro --- %>
  <div class="flex justify-between items-center mb-8 bg-stone-50 p-6 rounded-xl border border-stone-200">
    <div>
      <p class="text-xs font-bold text-stone-500 uppercase mb-1">Faturamento Total</p>
      <p class="text-4xl font-black text-green-700"><%= number_to_currency(@faturamento_total) %></p>
    </div>
    <div class="text-right">
      <p class="text-xs font-bold text-stone-500 uppercase mb-1">Total de Pedidos</p>
      <p class="text-4xl font-black text-stone-700"><%= @vendas.count %></p>
    </div>
  </div>

  <%# --- Tabela --- %>
  <table class="w-full text-left border-collapse text-sm">
    <thead>
      <tr class="bg-stone-800 text-white">
        <th class="p-3 text-xs uppercase tracking-wider rounded-l-lg">ID / Data</th>
        <th class="p-3 text-xs uppercase tracking-wider">Cliente</th>
        <th class="p-3 text-xs uppercase tracking-wider">Itens</th>
        <th class="p-3 text-xs uppercase tracking-wider text-right rounded-r-lg">Valor</th>
      </tr>
    </thead>
    <tbody class="text-stone-600">
      <% @vendas.each do |venda| %>
        <tr class="border-b border-stone-100 hover:bg-stone-50">
          
          <td class="p-3 align-top">
            <span class="block font-bold text-stone-800">#<%= venda.id %></span>
            <span class="text-xs text-stone-400"><%= venda.updated_at.strftime("%d/%m/%y %H:%M") %></span>
          </td>
          
          <td class="p-3 align-top font-medium">
            <%= venda.respond_to?(:cliente_nome) && venda.cliente_nome.present? ? venda.cliente_nome : (venda.user.try(:nome) || "Cliente ##{venda.user_id}") %>
          </td>
          
          <td class="p-3 align-top">
            <ul class="text-xs space-y-1">
              <% venda.order_items.each do |item| %>
                <li>
                  <span class="font-bold"><%= item.quantidade %>x</span> <%= item.product.nome %>
                </li>
              <% end %>
            </ul>
          </td>
          
          <td class="p-3 align-top text-right font-bold text-stone-800">
            <%= number_to_currency(venda.total) %>
          </td>

        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="mt-12 text-center text-[10px] text-stone-400 border-t border-stone-100 pt-4">
    <p>Sistema A Mineirinha - Controle Interno</p>
  </div>
</div>